# HTTP
## cookie
### 背景
最开始的HTTP是无状态的，无法识别客户端，为了提供个性化的服务：[eg:个性化问候、推荐、信息存储、会话记录]，服务端需要对用户进行标识，cookie 便是其中一种手段。

#### 通用的识别用户手段：

1. HTTP首部
2. 用户IP
3. 登录
4. 胖URL(用户信息存在URL中)
5. cookie

##### HTTP首部：

|首部名称|首部类型|描述|使用|
|:---:|:---:|:---:|:---|
|From|请求|用户的E-mail地址|用户并不希望`E-mail`被滥用，所以很少使用|
|User-Agent|请求|用户的`浏览器`软件|并没有明确的用户信息，识别用户的能力较弱|
|Referer|请求|用户做链接跳转的来源页|可以说明用户的`浏览行为`，分析用户的兴趣|
|Authorization|请求|`用户名和密码`|详见【用户登录】|
|Client-IP|扩展(请求)|客户端`IP`|详见【客户端IP】|
|X-forwarded-For|扩展(请求)|客户端`IP`|详见【客户端IP】|
|Cookie|扩展(请求)|`服务器产生的ID`标签|下文详细介绍|

##### 客户端IP

IP通常不会变更，但是以下场景并不能根据IP确定用户：

1. 多用户共享机器
2. 服务商提供了动态IP分配服务
3. 为了提高安全性，使用防火墙做网络地址转发，实际IP被转发为共享IP的某个端口
4. 使用代理，（有些代理可以通过`Client-IP`和`X-forwarded-For`）保存原始IP)


##### 用户登录

用户登录是一种服务器主动要信息的方式，用户可能会因为登录流程繁琐而放弃浏览，登录名和密码虽加密也可能会被破解。

流程为：

1. 用户请求
2. 服务器响应401，并带有`www-Authenticate`首部和`Authorization`首部
3. 客户端将用户名和密码放在 Authorization 首部并发送，并记录，当下次请求是会自动带上
4. 服务器返回用户请求的数据

##### 胖URL

客户端和服务器经过协商后，通过在URL上标识用户信息，来区分用户。

这种方式有明显的不足：

1. URL很丑陋
2. 公用链接无法多用户共享
3. 破坏了缓存
4. 返回未加标识的普通URL后，用户状态丢失
5. 服务器解析完用户信息，会重写HTML，增加了服务器负载
6. 会话级别，非持久

##### cookie
cookie像服务器给浏览器贴的贴纸，标识了一系列用户信息。

cookie 可被浏览器和客户端添加值，存储在客户端。

cookie中常用的属性：

|属性|用途|
|:---:|:---:|
|name|cookie的`键`|
|value|cookie的`值`|
|domain|`域名`，同域名共享|
|path|`路径`，同域名下的同路径共享|
|secure|`安全`，是否只在SSL链接中使用|
|expiration|`过期`，设置了在过期值之前都有效，否则会话级别有效|
|allh|所有`主机`，是否是所有主机都共享|




